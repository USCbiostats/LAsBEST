---
title:  "<span style=color:#003399> Descriptive Statistics </span>"
author: "Partially adapted from tableone's vignette"
date: "6/15/2021"
output: ioslides_presentation
widescreen: true
smaller: true
keep_md: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## <span style="color:#660066"> Descriptive Statistics  </span> 
- First analytical task to understand the data and begin to see patterns 
- Numerical and graphical description of the data 
- Today we'll (mostly) focus on univariate summary statistics (i.e. one variable at time)
- We'll discuss bivariate summary statistics (i.e. two variables at a time) next week

## <span style="color:#660066"> Mayo Clinic's PBC data </span> 
- Mayo Clinic trial in primary biliary cirrhosis (PBC) of the liver 
- Conducted between 1974 and 1984. 
- Placebo controlled trial of the drug D-penicillamine. 
- First 424 PBC patients 
- First 312 cases in the data set participated in the randomized trial and contain largely complete data. 
- Additional 106 subjects did not participate in the clinical trial but consented to have data collected

```{R}
setwd("~/LA's best")
pbc = read.csv('pbc.csv')
dim(pbc) #How many observations (rows) and how many variables (columns)
```
## <span style="color:#660066"> Mayo Clinic's PBC data </span> {.smaller}

Categorical variables:

- id
- status: 0=alive, 1=liver transplant, 2=dead
- trt: 1 = D-penicillamine, 2=placebo
- sex: 0=male, 1=female
- presence of ascites: 0=no 1=yes
- presence of hepatomegaly: 0=no 1=yes
- presence of spiders 0=no 1=yes
- presence of edema: 0=no edema and no diuretic therapy for edema; 
                    .5 = edema present without diuretics, or edema resolved by diuretics; 
                     1 = edema despite diuretic therapy
- histologic stage of disease
                    
## <span style="color:#660066"> Mayo Clinic's PBC data </span> {.smaller}

Quantitative variables:

- number of days between registration and the earlier of death, transplantion, or study analysis time in July, 1986
- age in days

- serum bilirubin in mg/dl
- serum cholesterol in mg/dl
- albumin in gm/dl
- urine copper in ug/day
- alkaline phosphatase in U/liter
- SGOT (Serum glutamic oxaloacetic transaminase) in U/ml
- triglycerides in mg/dl
- platelets per cubic ml/1000
- prothrombin time in seconds

## <span style="color:#660066"> Mayo Clinic's PBC data </span> {.smaller}
```{r}
summary(pbc)
```

## <span style="color:#660066"> Mayo Clinic's PBC data </span> {.smaller}
```{r}
head(pbc)
pbc$sex = factor(pbc$sex, levels = c('m', 'f'), labels = c('M', 'F'))
pbc$trt = factor(pbc$trt, levels = c(1,2), labels = c('D-penicillamine', 'placebo'))
pbc$status = factor(pbc$status, levels = c(0,1,2), labels = c('alive', 'liver transplant', 'dead'))
```

## <span style="color:#660066"> Mayo Clinic's PBC data </span> {.smaller}

```{R}
str(pbc)
```

## <span style="color:#660066"> Histograms  </span> 
Histogram: univariate graphical summary for a quantitative/continuous variable

```{r}
hist(pbc$age)
```

## <span style="color:#660066"> Descriptive stats for quantitative variables  </span> {.smaller}

Measures of location: mean, mode, median, first quartile, third quartile, minimum, maximum
```{r}
mean(pbc$age)
median(pbc$age)
min(pbc[,'age'])
max(pbc[, 5])    # Not recommended to subset by column number
```

## <span style="color:#660066"> Descriptive stats for quantitative variables  </span> {.smaller}

Measures of dispersion: variance, standard deviation, interquantile range (IQR)

```{r}
var(pbc$age)
sd(pbc$age)
IQR(pbc[,'age'])
```

## <span style="color:#660066"> Boxplots  </span> {.smaller}

Boxplots combines key summary stats (median, quartiles, IQR) into a summary plot

```{r}
boxplot(pbc$trig, main = 'Triglycerides')
```

Is Triglycerides skewed left or right?

## <span style="color:#660066"> Histogram and boxplot on same plot </span> 

```{r}
par(mfrow = c(1, 2))
hist(pbc$trig, main='Triglycerides')
boxplot(pbc$trig, main = 'Triglycerides')
```

## <span style="color:#660066"> Multiple Histograms </span> {.smaller}

```{r eval=FALSE, include=TRUE}
par(mfrow = c(2, 3))

hist(pbc$chol, main='Cholesterol')
hist(pbc$albumin, main='Albumin')
hist(pbc$copper, main='Copper')
hist(pbc$alk.phos, main='Alkaline phosphatase')
hist(pbc$trig, main='Triglycerides')
hist(pbc$platelet, main='Platelets')
```

## <span style="color:#660066"> Multiple Histograms </span>

```{r echo=FALSE}
par(mfrow = c(2, 3), mar=c(3,5,3,1))

hist(pbc$chol, main='Cholesterol')
hist(pbc$albumin, main='Albumin')
hist(pbc$copper, main='Copper')
hist(pbc$alk.phos, main='Alkaline phosphatase')
hist(pbc$trig, main='Triglycerides')
hist(pbc$platelet, main='Platelets')
```

## <span style="color:#660066"> Multiple boxplots (Version 1) </span> 

```{r echo=TRUE}
boxplot(pbc[, c("chol", "albumin", "copper", "alk.phos", "trig", "platelet")])
```

## <span style="color:#660066"> Multiple boxplots (Version 2 ) </span> {.smaller}

```{r eval=FALSE, include=FALSE}
par(mfrow = c(2, 3))

boxplot(pbc$chol, main='Cholesterol')
boxplot(pbc$albumin, main='Albumin')
boxplot(pbc$copper, main='Copper')
boxplot(pbc$alk.phos, main='Alkaline phosphatase')
boxplot(pbc$trig, main='Triglycerides')
boxplot(pbc$platelet, main='Platelets')
```

```{r echo=FALSE}
par(mfrow = c(2, 3), mar=c(1,5,3,1))

boxplot(pbc$chol, main='Cholesterol')
boxplot(pbc$albumin, main='Albumin')
boxplot(pbc$copper, main='Copper')
boxplot(pbc$alk.phos, main='Alkaline phosphatase')
boxplot(pbc$trig, main='Triglycerides')
boxplot(pbc$platelet, main='Platelets')
```

## <span style="color:#660066"> Descriptive stats for categorical variables  </span> {.smaller}
Numerical summary: Counts and proportion/percent per category


```{r}
table(pbc$stage)
prop.table(table(pbc$stage))
```

## <span style="color:#660066"> Descriptive stats for categorical variables  </span> {.smaller}
Graphical summary: Barplot

```{r, fig.height = 4, fig.width = 4, fig.align = "center"}
barplot(table(pbc$stage), main = 'stage')
```

## <span style="color:#660066">  Package tableone </span> 

```{r echo=TRUE}
library(tableone)
```

- Makes it easy to construct table of baseline characteristics 
- Commonly found in biomedical research papers as 'Table 1'. 
- Can summarize  continuous and categorical variables on same table. 
- Categorical variables can be summarized as counts and/or percentages. 
- Continuous variables can be summarized by means and standard deviations 
- or by medians and interquartile ranges.

## <span style="color:#660066"> Table 1 example </span> {.smaller}

```{r echo=FALSE, fig.height = 5, fig.width = 5, fig.align = "center"}
library(png)
library(grid)
appimg <- readPNG('Table1.2.png')
grid.raster(appimg)
```
From Roy et al. Rhythm Control versus Rate Control for Atrial Fibrillation and Heart Failure. NEJM (2008)


## <span style="color:#660066"> Single group summary </span> ## {.smaller}
- Simplest use is for summarizing whole dataset. 
- You can just feed in the data frame to the function CreateTableOne(). 

```{r eval=FALSE, include=TRUE}
CreateTableOne(data = pbc)
```

## <span style="color:#660066"> Single group summary </span> ## {.smaller}
```{r echo=FALSE}
CreateTableOne(data = pbc)
```

## <span style="color:#660066"> Subset of variables </span> ## {.smaller}
Can specify a subset of variables to summarize using the vars argument (e.g. exclude id variable)

```{r}
## Get variables' names
names(pbc)

## Vector of variables to summarize
myVars <- c("status", "trt", "age", "sex", "ascites", 
            "albumin", "copper", "stage")
```

```{r, eval=FALSE, include=TRUE}
CreateTableOne(data = pbc, vars = myVars)
```

## <span style="color:#660066"> Subset of variables </span> ## {.smaller}

```{r echo=FALSE}
CreateTableOne(data = pbc, vars = myVars)
```

## <span style="color:#660066"> Categorical variables </span> ## {.smaller}

- Some categorical variables are coded numerically in the dataframe (e.g. ascites, hepato)
- Need to either transform to factors as we did above for trt, sex and status
- or use factorVars argument to transform them on-the-fly. 

```{r}
catVars <- c("ascites", "stage")
```

## <span style="color:#660066"> Categorical variables </span> ## 

- Binary categorical variables are summarized as counts and percentages of the second level
- For 3+ category variable all levels are summarized 
- Percentages are calculated after excluding missing values.

```{r}
tab2 = CreateTableOne(vars = myVars, data = pbc, factorVars = catVars)
```

```{r, eval=FALSE, include=TRUE}
tab2
```

## <span style="color:#660066"> Categorical variables </span> ## 
```{r echo=FALSE}
tab2
```

## <span style="color:#660066"> Showing all categories </span> ## {.smaller}
```{r}
print(tab2, showAllLevels = TRUE)
```

## <span style="color:#660066"> Recoding ascites </span> {.smaller}
```{r}
pbc$ascites = factor(pbc$ascites, levels = c(0,1), labels = c('No', 'Yes'))
tab2 = CreateTableOne(vars = myVars, data = pbc, factorVars = catVars)
print(tab2, showAllLevels = TRUE)
```

## <span style="color:#660066"> Detailed information on missing values </span> {.smaller}
```{r}
summary(tab2$ContTable)
```

## <span style="color:#660066"> Detailed information on missing values </span> {.smaller}
```{r}
summary(tab2$CatTable)
```

## <span style="color:#660066"> Summarizing nonnormal variables </span> {.smaller}

- albumin, and copper are negatively and positively skewed respectively
- Age is symmetric, bell-shaped, normal looking
- Skewed distributions are not well summarized by mean and sd
- Use median and IQR for skewed/nonnormal variables 

```{r}
skewed <- c("albumin","copper")
```

```{r, eval=FALSE, include=TRUE}
print(tab2, nonnormal = skewed)
```

## <span style="color:#660066"> Summarizing skewed variables </span> {.smaller}
```{r, echo=FALSE}
print(tab2, nonnormal = skewed)
```
## <span style="color:#660066"> Fine tuning </span> {.smaller}
Check out ?print.TableOne for the list of options (partial list below):

catDigits:
Number of digits to print for proportions. Default 1.

contDigits:	
Number of digits to print for continuous variables. Default 2.

quote:	
Whether to show everything in quotes. The default is FALSE. If TRUE, everything including the row and column names are quoted so that you can copy it to Excel easily.

missing:
Whether to show missing data information.

explain:	
Whether to add explanation to the variable names, i.e., (%) is added to the variable names when percentage is shown.

## <span style="color:#660066"> Stratified table </span> {.smaller}
We may want to summarize by levels of a categorical variable (e.g., treatment) 

```{r}
myVars = myVars <- c("status",  "age", "sex", "ascites", "albumin", "copper", "stage")
tab3 <- CreateTableOne(vars = myVars, strata = "trt" , data = pbc, factorVars = catVars)
```
```{r, eval=FALSE, include=TRUE}
print(tab3, nonnormal = skewed, formatOptions = list(big.mark = ","))
```

## <span style="color:#660066"> Stratified table </span> {.smaller}
```{r echo=FALSE}
print(tab3, nonnormal = skewed)
```

## <span style="color:#660066"> Exporting table to csv </span> 
```{r}

tab3Mat <- print(tab3, nonnormal = skewed, exact = "stage", quote = FALSE, 
                 noSpaces = TRUE, printToggle = FALSE)

write.csv(tab3Mat, file = "myTable1.csv")
